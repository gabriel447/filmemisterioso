<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filme Misterioso</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<style>
    html {
        padding: 0;
        margin: 0;
        height: 100vh;
        width: 100%;
        box-sizing: border-box;
    }

    body {
        background-image: url('src/room.jpg');
        background-size: cover;
        background-position: center;
        color: white;
        width: 100%;
    }

    .card {
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: white;
        border-radius: 15px;
        padding: 20px;
        margin: 20px auto;
        width: max-content;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    #moviePoster {
        object-fit: cover;
        height: auto;
    }

    .form-check-input-stream {
        display: none;
    }

    .stream-icon {
        width: 50px;
        height: 50px;
        border-radius: 5px;
        margin-right: 5px;
        transition: border-color 0.3s ease;
    }

    .form-check-input-stream:checked+label .stream-icon {
        border: 2px solid #007bff !important;
    }

    .modal-backdrop.show {
        opacity: 0.9;
    }

    #moviePoster {
        transition: transform 0.3s ease;
    }

    #moviePoster:hover {
        transform: scale(1.05);
    }

    .genre-tag {
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        padding: 4px 12px;
        font-size: 0.9rem;
        transition: background-color 0.3s ease;
    }

    .genre-tag:hover {
        background-color: rgba(255, 255, 255, 0.2);
    }

    .close-button {
        position: absolute;
        top: 10px;
        right: 10px;
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #000;
        padding: 5px;
        border-radius: 50%;
        transition: background-color 0.3s ease;
    }

    .close-button:hover {
        background-color: rgba(0, 0, 0, 0.1);
    }

    #genre-list>div {
        margin-right: 20px;
    }
</style>

<body>
    <main class="container-fluid d-flex justify-content-center align-items-center min-vh-100 flex-column">
        <div class="text-center">
            <h2>Que tal um Filme Misterioso ?</h2>
            <p>Escolha o stream e o gênero, <br> que sortearemos um ótimo filme pra você aproveitar.</p>
        </div>
        <div class="card">
            <form id="myForm">
                <div class="d-flex">
                    <div class="col-md-12 text-md-start text-sm-center">
                        <p><strong>Selecione o stream:</strong></p>
                        <div class="d-flex mb-3 mt-2">
                            <div class="form-check-stream">
                                <input id="netflix" class="form-check-input-stream" type="radio" name="stream" value="8"
                                    checked>
                                <label class="form-check-label" for="netflix">
                                    <img src="src/icons8-netflix-48.png" class="stream-icon p-1" alt="Netflix">
                                </label>
                            </div>
                            <div class="form-check-stream">
                                <input id="amazon-prime" class="form-check-input-stream" type="radio" name="stream"
                                    value="119">
                                <label class="form-check-label" for="amazon-prime">
                                    <img src="src/icons8-amazon-prime-video-48.png" class="stream-icon"
                                        alt="Amazon Prime">
                                </label>
                            </div>
                            <div class="form-check-stream">
                                <input id="hbo" class="form-check-input-stream" type="radio" name="stream" value="1899">
                                <label class="form-check-label" for="hbo">
                                    <img src="src/icons8-hbo-max-50.png" class="stream-icon" alt="HBO">
                                </label>
                            </div>
                            <div class="form-check-stream">
                                <input id="apple" class="form-check-input-stream" type="radio" name="stream" value="2">
                                <label class="form-check-label" for="apple">
                                    <img src="src/icons8-apple-tv-48.png" class="stream-icon" alt="Apple">
                                </label>
                            </div>
                            <div class="form-check-stream">
                                <input id="disney" class="form-check-input-stream" type="radio" name="stream"
                                    value="337">
                                <label class="form-check-label" for="disney">
                                    <img src="src/icons8-disney-plus-48.png" class="stream-icon" alt="Disney">
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="d-flex">
                    <div class="col-md-12 text-start">
                        <p><strong>Selecione o gênero:</strong></p>
                        <div id="genre-list" class="d-flex my-2">
                            <div class="col-md-6">
                                <div id="checkgenre" class="form-check-genre">
                                    <input class="form-check-input-genre" type="radio" name="genre" id="acao" value="28"
                                        checked>
                                    <label class="form-check-label" for="acao">Ação</label>
                                </div>
                                <div id="checkgenre" class="form-check-genre">
                                    <input class="form-check-input-genre" type="radio" name="genre" id="aventura"
                                        value="12">
                                    <label class="form-check-label" for="aventura">Aventura</label>
                                </div>
                                <div id="checkgenre" class="form-check-genre">
                                    <input class="form-check-input-genre" type="radio" name="genre" id="animacao"
                                        value="16">
                                    <label class="form-check-label" for="animacao">Animação</label>
                                </div>
                                <div id="checkgenre" class="form-check-genre">
                                    <input class="form-check-input-genre" type="radio" name="genre" id="comedia"
                                        value="35">
                                    <label class="form-check-label" for="comedia">Comédia</label>
                                </div>
                                <div id="checkgenre" class="form-check-genre">
                                    <input class="form-check-input-genre" type="radio" name="genre" id="crime"
                                        value="80">
                                    <label class="form-check-label" for="crime">Crime</label>
                                </div>
                                <div id="checkgenre" class="form-check-genre">
                                    <input class="form-check-input-genre" type="radio" name="genre" id="romance"
                                        value="10749">
                                    <label class="form-check-label" for="romance">Romance</label>
                                </div>

                            </div>
                            <div class="col-md-6">
                                <div id="checkgenre" class="form-check-genre">
                                    <input class="form-check-input-genre" type="radio" name="genre"
                                        id="ficcao-cientifica" value="878">
                                    <label class="form-check-label" for="ficcao-cientifica">Ficção</label>
                                </div>
                                <div id="checkgenre" class="form-check-genre">
                                    <input class="form-check-input-genre" type="radio" name="genre" id="drama"
                                        value="18">
                                    <label class="form-check-label" for="drama">Drama</label>
                                </div>
                                <div id="checkgenre" class="form-check-genre">
                                    <input class="form-check-input-genre" type="radio" name="genre" id="fantasia"
                                        value="14">
                                    <label class="form-check-label" for="fantasia">Fantasia</label>
                                </div>
                                <div id="checkgenre" class="form-check-genre">
                                    <input class="form-check-input-genre" type="radio" name="genre" id="guerra"
                                        value="10752">
                                    <label class="form-check-label" for="guerra">Guerra</label>
                                </div>
                                <div id="checkgenre" class="form-check-genre">
                                    <input class="form-check-input-genre" type="radio" name="genre" id="terror"
                                        value="27">
                                    <label class="form-check-label" for="terror">Terror</label>
                                </div>
                                <div id="checkgenre" class="form-check-genre">
                                    <input class="form-check-input-genre" type="radio" name="genre" id="suspense"
                                        value="9648">
                                    <label class="form-check-label" for="suspense">Suspense</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="text-start mt-2">
                    <button class="btn btn-primary" type="submit">Sortear</button>
                </div>
            </form>
        </div>
    </main>
    <div id="movieModal" class="modal fade" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content bg-dark text-white">
                <div class="modal-header">
                    <h5 class="modal-title" id="movieOriginalTitle"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4">
                            <img id="moviePoster" src="" alt="" class="img-fluid rounded shadow-lg">
                        </div>
                        <div class="col-md-8">
                            <div class="mb-3">
                                <h2 id="movieTitle" class="fw-bold"></h2>
                                <span id="movieReleaseDate" class="badge bg-secondary ms-2"></span>
                            </div>
                            <div class="mb-3">
                                <p id="movieOverview" class="text-white"></p>
                            </div>
                            <div class="mb-3">
                                <div class="d-flex align-items-center gap-2">
                                    <span class="fas fa-star text-warning"></span>
                                    <span id="movieRating" class="fw-bold"></span>
                                    <span class="text-muted">/10</span>
                                </div>
                            </div>
                            <div class="mb-3">
                                <small>Gêneros:</small>
                                <div id="movieGenres" class="d-flex flex-wrap gap-2"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" id="btn-close" class="btn btn-secondary"
                        data-bs-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#myForm').on('submit', function (event) {
                event.preventDefault();

                const formData = {
                    stream: $('input[name="stream"]:checked').val(),
                    genre: $('input[name="genre"]:checked').val()
                };

                const movieResult = getPageMovie(formData);
                const pageMovies = movieResult.data.results;
                const randomMovie = pageMovies[Math.floor(Math.random() * pageMovies.length)];

                displayMovieDetails(randomMovie);
            });

            function getPageMovie(formData) {
                const dev = '../private/jomsvikings.php';
                const prod = '';
                return $.ajax({
                    url: dev,
                    type: 'POST',
                    data: formData,
                    async: false,
                    success: function(response) {
                        return response;
                    },
                    error: function(xhr, status, error) {
                        console.error('Erro na requisição:', error);
                        return null;
                    }
                }).responseJSON;
            }

            function displayMovieDetails(movie) {
                $('#movieOriginalTitle').text('Título Original - ' + movie.original_title);
                $('#movieTitle').text(movie.title);
                $('#movieReleaseDate').text(new Date(movie.release_date).getFullYear());

                const posterUrl = movie.poster_path
                    ? `https://image.tmdb.org/t/p/w342${movie.poster_path}`
                    : 'src/poster-fallback.jpg';
                $('#moviePoster').attr('src', posterUrl);

                $('#movieOverview').text(movie.overview);

                $('#movieRating').text(movie.vote_average.toFixed(1));

                $('#movieGenres').empty();
                movie.genre_ids.forEach(id => {
                    const genreTag = $('<span>')
                        .addClass('badge genre-tag')
                        .text(getGenreName(id));
                    $('#movieGenres').append(genreTag);
                });

                const modal = new bootstrap.Modal(document.getElementById('movieModal'));
                modal.show();
            }

            function getGenreName(id) {
                const genres = {
                    28: 'Ação', 12: 'Aventura', 16: 'Animação', 35: 'Comédia',
                    80: 'Crime', 99: 'Documentário', 18: 'Drama', 10751: 'Família',
                    14: 'Fantasia', 36: 'História', 27: 'Terror', 10402: 'Musical',
                    9648: 'Suspense', 10749: 'Romance', 878: 'Ficção Científica',
                    10770: 'Cinema TV', 53: 'Thriller', 10752: 'Guerra', 37: 'Faroeste'
                };
                return genres[id] || 'Gênero Desconhecido';
            }
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>